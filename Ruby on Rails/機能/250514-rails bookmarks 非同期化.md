## 非同期化（Ajax）

------

### 非同期化

　非同期通信とはリクエストを送信した後、サーバーからのレスポンスを待たずに他の処理を実行することができる通信方式のこと。この通信を利用することで、Webページ全体をリロードすることなく、一部のデータのみを更新することが可能になる。非同期通信が用いられる例としては、「フォームの入力情報の送信」「チャットアプリケーションにおけるメッセージの送受信表示」などが挙げられる。

### Ajax

　Ajaxとは、非同期通信を実現するための代表的な技術のことを示す。javascriptを使って非同期的にサーバーとデータ通信を行い、ページ全体をリロードせずに必要な部分のみを更新する。

### gem 'turbo-rails'

　gem 'turbo-rails'はRails アプリケーションを高速かつインタラクティブにするためのgemのこと。

```ruby
gem 'turbo-rails', '1.1.1'
```

- Turbo Drive : ページ全体の再度読み込みを避けて部分更新を行う
- Turbo Frams：ページの特定部分だけを動的に更新する
- Turbo Streams：リアルタイムでページの一部を更新し、サーバーからのデータを即座に反映させる。
  ＊ 独自のレスポンス形式設定が必要。

### 手順

1. コントローラー
   - 非同期化したいアクション定義に移り、アクション完了後に繋がるようにしていたパスを削除する（ redirect_to xxxx を削除）　
   - ここを削除しておかないと非同期通信がきちんと動作しない
     → アクションを行った際、対象アクションのビューを呼ぶ必要がある。
2. ビュー
   - 非同期化するアクションのビュー切り替え準備
     　アクション完了 / 未完了 のビューの用意
   - コントローラーから渡ってきた対象オブジェクトのIdを受け取って、処理の実行を行うためのファイルが必要
     ＊ここでturbo_streamの機能が用いられる。





#### 一言メモ

------

- SPA ：ページ全体をリロードせず、部分的に書き換えるアプリのこと

- Hotwire ： Rails において、SPA的な体験を簡単に作るための仕組み（Turbo/Stimulus）

- Turbo_stream通信
  ```ruby
  def update
    # ...処理...
    respond_to do |format|
      format.turbo_stream # ← Turbo Streams用
      format.html         # ← 通常のHTML用
    end
  end
  ```

  ＊Turbo_stream用にデータ返信の方法を指定しておく必要あり
